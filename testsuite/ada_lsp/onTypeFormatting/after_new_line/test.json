[
  {
    "comment": [
      "This test checks that the textDocument/onTypeFormatting request ",
      "does not edit a construct if there is an empty line between",
      "the construct and the cursor."
    ]
  },
  {
    "start": {
      "cmd": [
        "${ALS}"
      ]
    }
  },
  {
    "send": {
      "request": {
        "jsonrpc": "2.0",
        "id": 0,
        "method": "initialize",
        "params": {
          "rootUri": "$URI{.}",
          "capabilities": {
            "workspace": {
              "applyEdit": true,
              "workspaceEdit": {
                "documentChanges": true,
                "resourceOperations": [
                  "create",
                  "rename",
                  "delete"
                ]
              },
              "didChangeConfiguration": {
                "dynamicRegistration": true
              },
              "executeCommand": {
                "dynamicRegistration": true
              },
              "configuration": true,
              "workspaceFolders": true
            },
            "textDocument": {
              "onTypeFormatting": {
                "dynamicRegistration": true
              }
            }
          }
        }
      },
      "wait": []
    }
  },
  {
    "send": {
      "request": {
        "jsonrpc": "2.0",
        "method": "workspace/didChangeConfiguration",
        "params": {
          "settings": {
            "ada": {
              "projectFile": "$URI{default.gpr}",
              "onTypeFormatting": {
                "indentOnly": false
              }
            }
          }
        }
      },
      "wait": [
        {
          "jsonrpc": "2.0",
          "method": "$/progress",
          "params": {
            "token": "<ANY>",
            "value": {
              "kind": "end"
            }
          }
        }
      ]
    }
  },
  {
    "send": {
      "request": {
        "jsonrpc": "2.0",
        "method": "textDocument/didOpen",
        "params": {
          "textDocument": {
            "uri": "$URI{main.adb}",
            "languageId": "ada",
            "version": 1,
            "text": "procedure Main is\n\nprocedure A is null;\nprocedure B is null;\n   \n\nbegin\n   null;\nend Main;\n"
          }
        }
      },
      "wait": []
    }
  },
  {
    "send": {
      "request": {
        "jsonrpc": "2.0",
        "method": "textDocument/didChange",
        "params": {
          "textDocument": {
            "uri": "$URI{main.adb}",
            "version": 2
          },
          "contentChanges": [
            {
              "range": {
                "start": {
                  "line": 5,
                  "character": 0
                },
                "end": {
                  "line": 5,
                  "character": 0
                }
              },
              "rangeLength": 0,
              "text": "\n"
            }
          ]
        }
      },
      "wait": []
    }
  },
  {
    "send": {
      "request": {
        "jsonrpc": "2.0",
        "id": 2,
        "method": "textDocument/onTypeFormatting",
        "params": {
          "textDocument": {
            "uri": "$URI{main.adb}"
          },
          "position": {
            "line": 6,
            "character": 0
          },
          "ch": "\n",
          "options": {
            "tabSize": 3,
            "insertSpaces": true
          }
        }
      },
      "wait": [
        {
          "jsonrpc": "2.0",
          "id": 2,
          "result": [
            {
              "range": {
                "start": {
                  "line": 6,
                  "character": 0
                },
                "end": {
                  "line": 6,
                  "character": 0
                }
              },
              "newText": "   "
            }
          ]
        }
      ]
    }
  },
  {
    "send": {
      "request": {
        "jsonrpc": "2.0",
        "id": 13,
        "method": "shutdown"
      },
      "wait": []
    }
  },
  {
    "stop": {
      "exit_code": 0
    }
  }
]
